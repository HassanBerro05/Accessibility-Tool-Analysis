# Data Preparation and Process

## 1. Dataset Overview
This section introduces the dataset, its origin, and the scope of analysis.

- **Source**: The dataset aggregates reports generated by the UDOIT accessibility tool. These reports are stored in a Heroku Postgres database.
- **Timeframe**: Records span from Winter 2021 to Winter 2023. Scans before January 1, 2021, were unavailable and excluded.
- **Data Reduction for Confidentiality**: 
  - Fields containing sensitive information were removed by ITS.
  - The reduced dataset includes 7 key columns:
    - `id`: Heroku-specific identifier irrelevant to analysis.
    - `user_id`: University-unique identifier for Canvas users.
    - `course_id`: Canvas-specific identifier for each course.
    - `date_run`: Timestamp of the UDOIT scan.
    - `errors`: Total number of errors detected in a scan.
    - `suggestions`: Suggestions generated.
    - `report_json_cleaned`: A JSON field containing detailed error summaries, including error types and their counts, as well as course-specific details.

      ### A Six Point Sample of Data

| id   | user_id | course_id | date_run                  | errors | suggestions | report_json_cleaned |
|------|---------|-----------|---------------------------|--------|-------------|----------------------|
| 1,553 | 137,XXXX | 587,XXXX   | 2022-11-01 15:09:29.497 -0400 | 2      | 6           | {"course": "FoL XXXX  Winter 2023-01", "user_id": 137XXXX, "course_id": "587XXXX", ...} |
| 1,489 | 474,XXXX | 563,XXXX   | 2022-08-11 17:04:24.342 -0400 | 80     | 152         | {"course": "F2022 XXXX GSI/IA Training", "user_id": 474XXXX, "course_id": "563XXXX", ...} |
| 1,602 | 642,XXXX | 486,XXXX   | 2022-11-09 15:11:03.196 -0500 | 0      | 6           | {"course": "LRC Tutoring Resources", "user_id": 642XXXX, "course_id": "486XXXX", ...} |
| 1,445 | 21,XXXX  | 20XXXX      | 2022-07-07 12:44:40.374 -0400 | 544    | 680         | {"course": "Canvas XXXX", "user_id": 21XXXX, "course_id": "20XXXX", ...} |
| 1,446 | 499,XXXX | 514,XXXX   | 2022-07-13 16:30:21.402 -0400 | 580    | 289         | {"course": "ENGR XXXX FA 2021", "user_id": 499XXXX, "course_id": "514XXXX", ...} |
| 1,447 | 177,XXXX | 484,XXXX   | 2022-07-18 09:03:42.757 -0400 | 43     | 1           | {"course": "Running XXXX 2022-2023", "user_id": 177XXXX, "course_id": "484XXXX", ...} |


    
---

## 2. Data Extraction
This section explains how the raw data was retrieved and prepared for initial use.

### Steps to Extract Data:
1. **Database Connection**:
   - Use DBeaver to connect to the Heroku Postgres database with credentials provided by ITS.
   - Navigate to the "Reports" table under the "Data" tab.

   <img src="https://github.com/HassanBerro05/Accessibility-Tool-Analysis/blob/main/Viz/Figure%2034.png?raw=true" alt="Dbeaver" width="500" height="300">
  
2. **Export Data**:
   - Export the table content as a CSV file.
   - Retain the following columns: `id`, `user_id`, `course_id`, `date_run`, and `errors`.
   - Remove `suggestions` and `report_json_cleaned` columns for simplicity.

3. **Date Formatting**:
   - If `date_run` appears in an unconventional format:
     - Double-click the first entry to reset it to a standard date and time format.
     - Use Excel’s format painter to apply the corrected format across the column.
   <img src="https://github.com/HassanBerro05/Accessibility-Tool-Analysis/blob/main/Viz/Figure%2035.png?raw=true" alt="Excel Painter" width="400" height="300">

---

## 3. Data Manipulation
This section details the transformations applied to the dataset to make it ready for analysis.

### 3.1 Parsing JSON Columns
- **Objective**: Extract additional details embedded in the `report_json_cleaned` column.
- **Approach**: SQL commands were used to parse JSON data for extracting course names and error details. For full scripts, refer to the [Extract Course Names SQL Script](#extract-course-names-sql-script) and [Parse Error Types and Counts](#parse-error-types-and-counts) section.
- The figure below shows a sample of the Extracted Columns
  
  ### Course Accessibility Report

| Course Name                         | EDUC XXXX WN 2021 | EDUC XXXX WN 2021 | DEV XXXX N2021_SV_V1 | DEV XXXX N2021_SV_V1 |
|--------------------------------------|--------------|--------------|----------------|----------------|
| brokenLink                           | 0            | 0            | 0              | 0              |
| aMustContainText                     | 0            | 0            | 6              | 6              |
| imgAltIsDifferent                    | 1            | 0            | 28             | 59             |
| imgAltIsTooLong                       | 0            | 0            | 0              | 0              |
| imgAltNotEmptyInAnchor                | 0            | 0            | 0              | 0              |
| imgHasAltDeco                         | 0            | 0            | 0              | 0              |
| tableDataShouldHaveTh                 | 4            | 0            | 1              | 1              |
| tableThShouldHaveScope                | 0            | 0            | 0              | 0              |
| cssTextHasContrast                    | 0            | 0            | 0              | 0              |
| headersHaveText                       | 0            | 0            | 0              | 0              |
| videosEmbeddedOrLinkedNeedCaptions    | 0            | 0            | 0              | 0              |
| headingLevelSkipped                   | 0            | 0            | 0              | 0              |
| fontIsNotUsed                         | 0            | 0            | 0              | 0              |
| videoProvidesCaptions                 | 0            | 0            | 0              | 0              |

- The Parse Error Types and Counts script produces output like that shown in Figure below, which includes, for each scan, its corresponding report ID, types of errors detected, and the number of each individual error.
<img src="https://github.com/HassanBerro05/Accessibility-Tool-Analysis/blob/main/Viz/Figure%2036.png?raw=true" alt="Individual Errors Extracted" title="Individual Errors Extracted"  width="500" height="300">


### 3.2 Mapping Subaccounts
- **Objective**: Associate each course with its subaccount and sub-subaccount for analysis.
- **Approach**: Excel `VLOOKUP` functions were used to map `course_id` to `sub-subaccount` and `subaccount`. Details are available in the [Mapping Subaccounts with VLOOKUP](#mapping-subaccounts-with-vlookup) section.
  
 <img src="https://github.com/HassanBerro05/Accessibility-Tool-Analysis/blob/main/Viz/Table%203%20c.PNG" alt="Sub-sub account mapping" title="Sub-subaccount Mapping"  width="500" height="100">

 <img src="https://github.com/HassanBerro05/Accessibility-Tool-Analysis/blob/main/Viz/Table%204%20subaccount%20mapping.png?raw=true" alt="Subaccount Mapping" title="Subaccount Mapping" width="500" height="100">

### 3.3 Anonymizing Users
- **Objective**: Preserve user confidentiality while enabling user-specific analysis.
- **Approach**:
   - Mapped `user_id` to anonymized IDs (`Anon_USER_ID`) using a one-to-one mapping system.


  
### 3.4 Extracting Target Areas
- **Objective**: Identify Canvas areas targeted during scans.
- **Approach**: SQL queries and Excel operations were used to parse and organize the scan area data. For specifics, see the [Extract Target Areas](#extract-target-areas) and [Binary Columns for Target Areas in Excel](#binary-columns-for-target-areas-in-excel) section.
<img src="https://github.com/HassanBerro05/Accessibility-Tool-Analysis/blob/main/Viz/Figure%2011%20Sample%20information%20of%20Target%20Areas%20c.PNG" alt="Sample Information on Target Areas" title="Sample Information on Target Areas"  width="500" height="200">

### 3.5 Manual Assessment for Additional Columns

#### 1. Faculty/Staff Column
- **Objective**: Classify users as faculty or staff for targeted analysis.
- **Approach**:
  - Queried the UM website for employment information based on user data.
  - For unresolved queries, university records provided by sponsors were consulted to complete classifications.

#### 2. Academic and Conforming Columns
- **Objective**: Categorize courses as academic or conforming to predefined standards.
- **Approach**:
  - Manually reviewed course details and applied subjective assessments.
  - Consulted with sponsors to validate classifications and refine criteria.

#### 3. Semester by Date and Semester by Type Columns
- **Objective**: Define the semester for each record based on scan dates and course type.
- **Approach**:
  - **Semester by Date**: Created using Table 9 as a reference to map scan dates to their respective semesters.
  - **Semester by Type**: Used subjective assessments and sponsor-provided insights to determine the semester type for each record.
---

## 4. Data Cleansing
This section describes how irrelevant records were removed to ensure dataset quality.

### Steps:
1. Identified unconventional Canvas courses, such as sandboxes, test courses, and experimental scans.
2. Developed a set of keywords (e.g., "sandbox", "test", "practice") to filter these records.
3. Collaborated with ITS to refine the filter and eliminate additional unwanted records.
4. Removed 144 records, affecting 15 users, to leave only relevant data.
5. Handled Missing Values

<img src="https://github.com/HassanBerro05/Accessibility-Tool-Analysis/blob/main/Viz/Figure%2041.png?raw=true" alt="Replacing N/A values" title="Replacing N/A values"  width="600" height="300">


---

## 5. SQL and Excel Procedures
This section provides a centralized reference for all technical commands and operations used in the data preparation process.

### SQL Scripts
#### Extract Course Names SQL Script

```sql
SELECT
    report_id,
    report_json_cleaned::json->>'course' AS course_name
FROM reports;
  ```
#### Parse Error Types and Counts
  ```sql
  SELECT
    id,
    json_each(report_json_cleaned::json->'error_summary').key AS error_type,
    json_each(report_json_cleaned::json->'error_summary').value::int AS error_count
FROM reports
WHERE json_typeof(report_json_cleaned::json->'error_summary') = 'object';
  ```
#### Extract Target Areas
  ```sql
  SELECT
    report_id,
    data::json->>'scan_item' AS scan_item
FROM job_queue;
  ```

### Excel Operations
1. #### Mapping Subaccounts with VLOOKUP
   - Use `VLOOKUP` to map `course_id` to `sub-subaccount`:
     ```plaintext
     Formula: =VLOOKUP(D2, $A$1:$C$252, 3, FALSE)
     ```
   - Use `VLOOKUP` again to map `sub-subaccount` to `subaccount`:
     ```plaintext
     Formula: =VLOOKUP(C2, $A$1:$B$58, 2, FALSE)
     ```

2. #### Splitting JSON Data in Excel
   - Apply "Text to Columns":
     ```plaintext
     - Go to Data > Text to Columns > Delimited.
     - Select delimiters: Space and Other (use '}').
     ```

3. #### Handling Missing Values in Excel
   - Replace `#N/A` with `0`:
     ```plaintext
     - Use Find and Replace: Find `#N/A`, Replace with `0`.
     ```

4. #### Binary Columns for Target Areas in Excel
   - Use the `IF` function:
     ```plaintext
     Formula: =IF(VLOOKUP(A2 & "ColumnTitle", $C$1:$D$5475, 2, FALSE) = 1, 1, 0)

    <img src="https://github.com/HassanBerro05/Accessibility-Tool-Analysis/blob/main/Viz/Figure%2044.png?raw=true" alt="Columnizing Scan Items" title="Columnizing Scan Items"  width="600" height="300">

     ```

---

## 6. Final Dataset
### Structure:
- **Total Columns**: 36, including:
  - 7 original columns (`id`, `user_id`, `course_id`, etc.).
  - 14 columns for individual error types.
  - 7 columns for Canvas target areas.
  - Additional columns for `subaccount`, `sub-subaccount`, and anonymized user IDs.
    
| Variable                                    | Description                          | Categorical | Continuous |
|--------------------------------------------|--------------------------------------|-------------|------------|
| Course Name                                | Name of a course                     | ✔            |           |
| Academic?                                  | Course type                          | ✔           |            |
| Conforming?                                | Course conformity                    | ✔            |           |
| Semester by Date                           | Semester by date                     | ✔           |            |
| Semester by Type                           | Semester by type                     | ✔            |           |
| Course ID                                  | Course identifier in Canvas          | ✔           |            |
| Date                                       | Date a scan was run                  | ✔            |           |
| User ID                                    | User identifier in Canvas            | ✔           |            |
| Anon_USER_ID                               | Encrypted user ID                    | ✔            |           |
| Username                                   | Name of a user                       | ✔           |            |
| Faculty/Staff                              | Is user faculty or staff?            | ✔            |           |
| Sub-Subaccount                             | Sub-subaccount of a course           | ✔           |            |
| Subaccount                                 | Subaccount of a course               | ✔            |           |
| Total Errors                               | Total errors for a scan              |             | ✔          |
| brokenLink                                 | Errors of this type for a scan       |             | ✔          |
| aMustContainText                           | Errors of this type for a scan       |             | ✔          |
| imgAltIsDifferent                          | Errors of this type for a scan       |             | ✔          |
| imgAltIsTooLong                            | Errors of this type for a scan       |             | ✔          |
| imgAltNotEmptyInAnchor                     | Errors of this type for a scan       |             | ✔          |
| imgHasAltDeco                              | Errors of this type for a scan       |             | ✔          |
| tableDataShouldHaveTh                      | Errors of this type for a scan       |             | ✔          |
| tableThShouldHaveScope                     | Errors of this type for a scan       |             | ✔          |
| cssTextHasContrast                         | Errors of this type for a scan       |             | ✔          |
| headersHaveText                            | Errors of this type for a scan       |             | ✔          |
| videosEmbeddedOrLinkedNeedCaptions         | Errors of this type for a scan       |             | ✔          |
| headingLevelSkipped                        | Errors of this type for a scan       |             | ✔          |
| fontIsNotUsed                              | Errors of this type for a scan       |             | ✔          |
| videoProvidesCaptions                      | Errors of this type for a scan       |             | ✔          |
| Announcements?                             | Was this area scanned?               | ✔            |           |
| Assignments?                               | Was this area scanned?               | ✔           |            |
| Discussions?                               | Was this area scanned?               | ✔            |           |
| Files?                                     | Was this area scanned?               | ✔           |            |
| Pages?                                     | Was this area scanned?               | ✔            |          |
| Syllabus?                                  | Was this area scanned?               | ✔           |            |
| Module URLs?                               | Was this area scanned?               | ✔            |           |



### Key Features:
- Cleaned and well-organized.
- Includes only relevant records for meaningful analysis.
- Ready for visualization and advanced analytics.

---



